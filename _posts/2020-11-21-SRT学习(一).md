[toc]

# SRT简介
SRT是一种传输协议，它能够在不可预知的网络（如Internet）上安全、可靠地传输数据。虽然任何数据类型都可以通过SRT传输，但它特别针对音频/视频流进行了优化。  
SRT可以作为视频流工作流的一部分应用于贡献和分发端点，并始终提供最佳质量和最低延迟的视频

随着数据包从源流向目标设备，SRT会检测并适应两个端点之间的实时网络状况。 SRT有助于补偿由于噪声网络上的拥塞而引起的抖动和带宽波动。 它的错误恢复机制最大程度地减少了Internet连接中典型的数据包丢失。 SRT支持AES加密以实现端到端的安全性

SRT起源于基于UDP的数据传输（UDT）协议。 尽管UDT是为通过公共网络进行高吞吐量文件传输而设计的，但它与实时视频的效果并不理想。 SRT是经过重大修改的版本，支持实时视频流

基于IP网络的低延迟视频传输通常采用UDP协议以MPEG-TS单播或多播流的形式。该解决方案非常适合受保护的网络，在该网络中，通过启用前向纠错（FEC）可以减轻任何数据包丢失。在不同城市，国家甚至大陆的站点之间实现相同的低延迟更具挑战性。 尽管卫星链路或专用MPLS网络是可能的，但这些都是昂贵的解决方案。使用较便宜的公共Internet连接，虽然价格较便宜，但要实现必要的数据包丢失恢复会带来相当大的带宽开销

即使UDT不是为实时流而设计的，其丢包恢复机制还是一个有趣的起点。 SRT的原始版本包括新的数据包重传功能，可对数据包丢失立即做出反应以启用实时流

为了实现低延迟的流传输，SRT必须解决时序问题。 来自源网络的流的特性通过在公共Internet上的传输而完全改变，这会引入延迟，抖动和数据包丢失。 反过来，这会导致解码问题，因为音频和视频解码器不会在预期的时间接收数据包。 使用大缓冲区有帮助，但是延迟增加了。
![](srt-1-1.png)
SRT包含一种机制，可在接收器端重新创建信号特性，从而大大减少了缓冲需求。 此功能是SRT协议本身的一部分，因此，一旦数据从接收方的SRT连接中流出，流特性便已正确恢复。
![](srt-1-2.png)
SRT协议最初是由Haivision Systems Inc.开发的，于2017年4月与Wowza Media Systems Inc.合作以开源形式发布。SRT协议是根据MPL-2.0发行的,其选择是因为它在推动采用开放方式之间取得了平衡。来源SRT，同时鼓励采用者社区做出改进的贡献。任何第三方都可以自由地在较大的作品中使用SRT源，而不管如何编译较大的作品。如果他们更改了源代码，则他们有义务向社区提供这些更改
Haivision和Wowza于2017年5月成立了SRT联盟（www.srtalliance.org），该联盟致力于继续开发和采用该协议。

# SRT 相对 UDT4 的改进
UDT是一种ARQ（自动重复请求）协议。它实现了ARQ（选择性重复）的第三次进化。UDT版本4（UDT4）的实现是作为“信息”提交给IETF的，但仍然是一个草案（draft-gg-UDT-03）
UDT旨在最大程度地利用容量，因此应用程序必须确保在发送数据时输入缓冲区始终可用。 当以合理的比特率发送实时视频时，与读取文件相比，数据包生成的速度较慢。 缓冲区耗尽会导致UDT传输算法中的某些复位。 同样，当发生拥塞时，发送方算法可能会阻塞UDT API，而是优先发送丢失列表中的数据包，从而无法处理新的视频帧。 实时视频无法暂停，因此应用程序将丢弃数据包（因为传输API被阻止）。 与UDT不同，SRT在实时数据包和重传数据包之间共享可用带宽，丢失或丢弃旧数据包而不是新数据包。
SRT的初始开发主要涉及对UDT版本4的一些更改和添加：
* 字节统计计数器
* 缓冲区大小（以毫秒为单位）以控制延迟（以时间单位测量缓冲区更易于配置延迟，并且与流比特率无关）
* ACK消息中的统计信息（接收速率和估计的链路容量）
* 控制数据包时间戳（在UDT草案中，但不在UDT4实现中）
* 时间戳漂移校正算法
* 定期的NAK报告（UDT4禁用了此草稿功能，而希望重新传输未确认的数据包，这对于实时流应用程序会占用过多的带宽）。
* 基于时间戳的数据包传递（配置的延迟）
* 基于UDT用户定义的控制包的SRT握手，用于交换对等配置和实现信息，以确保在演进协议的同时进行无缝升级，并保持向后兼容性
* 基于配置值或测量的输入速率的最大输出速率
### 加密
* 通过密码生成密钥材料
* 使用UDT用户定义的控制包交换密钥资料和解密状态（发送者知道接收者是否可以正确解密流）
* AES-CTR加密/解密：在数据标题的消息号中重新分配2位，以指定用于加密的密钥（奇/偶/无；类似于DVB加扰控制字段
* 确保CTR耗尽后密钥恢复流畅
SRT的早期开发是在内部网络上使用硬件编码器和解码器（来自Haivision的Makito X系列）进行的，其中随机分布的数据包丢弃在
使用netem实用程序进行仿真1
在存在中等丢包的情况下，解码器会经历缓冲区耗尽（没有要解码的包）。 丢失的数据包没有及时重传。 解决此问题的方法是更早触发未确认的数据包重传（ARQ的自动重复）。但是，这导致带宽使用激增。如果没有足够快地确认数据包，则会在超时时重传。 在UDT4中，仅当丢失列表为空时才发生此重传
重新传输所有ACK到期的数据包（发送时间超过RTT毫秒之前）解决了测试方案，因为没有拥塞，并且随机数据包丢弃会影响不同的数据包。 重传多次后，所有数据包将被传送，并且接收方的队列将被解除阻塞。 因为当时没有发送速率控制，这是以占用大量带宽为代价的

# 包结构
SRT保留了UDT的UDP数据包结构，但进行了一些修改。 有关更多详细信息，请参阅UDT IETF Internet草案（draft-gg-udt-03.txt）的第2节
每个承载SRT流量的UDP数据包都包含一个SRT标头（紧随UDP标头之后）。 在所有版本中，SRT标头都包含四个主要的32位字段：

## 数据和控制包
## 握手包
## 密钥消息错误响应包
## 应答包
## 保活包
## 否定确认控制包
## 关闭控制包
## 确认控制包
## 扩展控制消息包
# SRT数据交换
# SRT 数据传输与控制
## 缓冲区
## 发送缓冲区管理
## SRT 缓冲区延迟
## SRT套接字，发送列表和通道
## 数据包确认（ACK）
## 数据包重传
## SRT中数据包确认
## 双向传输队列
## ACK，ACKACK和往返时间
## 漂移管理
## 损失清单
# SRT Packet Pacing
## 数据包探针
# 发送者的算法
# 接收者的算法
# 损失信息压缩方案
# UDP多路复用器
# 计时器
# 流控制
# 可配置的拥塞控制（CCC）
## 控制接口
## 本地控制算法
# SRT加密
## 总览
## 定义
## 加密过程演练
## 消息
## 参数
## 安全问题
## 实施说明
# SRT 握手
## 总览
## 握手结构
## “旧版”和“ SRT扩展”握手
## 呼叫者-听者握手
## 交会握手
## SRT扩展握手
## SRT扩展命令
## SRT拥塞控制
## 流标识(SID)
# 实施样例 - 具有SRT扩展的HSv4（旧式）呼叫者/监听者握手
# 术语
# 参考文献
## SRT联盟
## SRT on GitHub
## UDT
## 加密
